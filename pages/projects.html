<!DOCTYPE html>
<html>

<head>
    <title>Projects</title>

    {meta}
</head>

<body>
    {nav}

    <main>
        <h1>Projects</h1>

        <p id="loadingProjects">Loading projects..</p>
        <div id="projectsList" class="hidden"></div>

        <script>
            function loadProjects(attempts = 3) {
                if (attempts == 0) {
                    document.getElementById("loadingProjects").innerHTML = "Failed to load projects"

                    return
                }

                fetch("/api/github/pins?type=json").then(res => res.json()).then(repos => {
                    repos.push({ name: "Snake", url: "/projects/snake/", description: "A fun little snake game" })

                    for (var repo of repos) {
                        var element = document.createElement("a")
                        element.href = repo.homepageUrl ? repo.homepageUrl : repo.url
                        element.innerHTML = `<p><h2>${repo.name.replace("-", " ")}</h2> - ${repo.description}</p>`

                        document.getElementById("projectsList").appendChild(element)
                    }

                    document.getElementById("loadingProjects").setAttribute("class", "hidden")
                    document.getElementById("projectsList").removeAttribute("class")
                }).catch(e => {
                    loadProjects(attempts - 1)
                })
            }
            loadProjects()
        </script>
    </main>

    {global}
</body>

</html>